$(document).ready(function(a){function b(){var s=[],t=[],w=new google.maps.Map(document.getElementById('map-wrapper'),{center:{lat:16.7395651,lng:106.3573632},zoom:6,mapTypeId:'roadmap'});a('.jobs-listing > .job-item').each(function(){var z=parseFloat(a(this).attr('job-lat')),A=parseFloat(a(this).attr('job-lng')),B=a(this).attr('job-wage'),D=a(this).prop('outerHTML');if(B=a(this).attr('job-wage').replace(/(\d)(?=(\d\d\d)+(?!\d))/g,'$1,')+' \u0111',D=a(D).html(B).removeClass('type-box').prop('outerHTML'),!isNaN(z)&&!isNaN(A)){var E=new google.maps.Marker({position:{lat:z,lng:A},map:w});t.push(E);var F=new google.maps.InfoWindow;F.setContent(D),F.open(w,E),s.push(F),google.maps.event.addListener(E,'click',function(G,H,I){return function(){I.setContent(D),I.open(w,G)}}(E,'',F))}});new MarkerClusterer(w,t,{imagePath:'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'})}function c(s,t,u){!0==r||(r=!0,a.ajax({url:'/ajax/job/search',method:'GET',data:{search:s,pagination:q,employer:u},success:function(v){'html'==t?a('.jobs-listing').html(v):a('.jobs-listing').append(v),'<input type="hidden" id="totalJob" value="">'!=v&&!0!=u&&b(),q++,r=!1},error:function(){},complete:function(){}}))}function d(s,t,u,v,w,y){!0==r||(r=!0,a.ajax({url:'/ajax/job/filter',method:'GET',data:{job_form:s,job_type:t,job_city:u,job_wage:v,job_wage_type:w,pagination:q},success:function(z){'html'==y?a('.jobs-listing').html(z):a('.jobs-listing').append(z);var A=a('#totalJob').val();a('.result > .title').text('C\xF3 '+A+' C\xF4ng vi\u1EC7c ph\xF9 h\u1EE3p').removeClass('hide'),b(),r=!1},error:function(){},complete:function(){}}))}function e(s){a.ajax({url:'/ajax/job/'+s,method:'GET',success:function(t){a('#modal-job .modal-content').html(t),a('#modal-job').modal('show')},error:function(){},complete:function(){}})}function f(s){a.ajax({url:'/ajax/job-cvs/'+s,method:'GET',success:function(t){a('#table-employer-cvs').html(t)},error:function(){},complete:function(){}})}function g(s,t,u){a.ajax({url:s,method:'PUT',headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},data:{status:t},success:function(v){1==v.status?u.parent().html('<span style="color: blue">Ch\u1EDD x\xE1c nh\u1EADn</span>'):('string'==typeof v.errors.message&&alert(v.errors.message),'object'==typeof v.errors.message&&alert(v.errors.message[Object.keys(v.errors.message)[0]]))},error:function(){},complete:function(){}})}function h(s,t,u){a.ajax({url:s,method:'PUT',headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},data:{active:t},success:function(v){1==v.status?'1'==t?u.parent().html('<span style="color: green">\u0110\xE3 x\xE1c nh\u1EADn</span>'):u.parent().html('<span style="color: red">T\u1EEB ch\u1ED1i</span>'):('string'==typeof v.errors.message&&alert(v.errors.message),'object'==typeof v.errors.message&&alert(v.errors.message[Object.keys(v.errors.message)[0]]))},error:function(){},complete:function(){}})}function j(s,t){a.ajax({url:s,method:'PUT',headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},success:function(u){1==u.status?t.parents('tr').remove():('string'==typeof u.errors.message&&alert(u.errors.message),'object'==typeof u.errors.message&&alert(u.errors.message[Object.keys(u.errors.message)[0]]))},error:function(){},complete:function(){}})}function k(s,t){a.ajax({url:'/ajax/post-cv/',method:'PUT',headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},data:{email:s,job_id:t},success:function(u){1==u.status?(alert('N\u1ED9p cv th\xE0nh c\xF4ng!'),a('#modal-send_cv .close').trigger('click')):('string'==typeof u.errors.message&&alert(u.errors.message),'object'==typeof u.errors.message&&alert(u.errors.message[Object.keys(u.errors.message)[0]]),401==u.status&&(a('[status="cv_none"]').removeClass('hide'),a('[status="cv_check"]').addClass('hide'),a('#modal-send_cv input[name="email"]').val(a('[name="user-email"]').val()),p=2))},error:function(u){console.log(u.status),401==u.status&&alert('B\u1EA1n ch\u01B0a \u0111\u0103ng nh\u1EADp')},complete:function(){}})}function l(){a.ajax({url:'ajax/reg-cv',method:'PUT',headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},data:a('#form-reg').serialize(),success:function(s){1==s.status?(alert('\u0110\u0103ng k\xFD th\xE0nh c\xF4ng. B\xE2y gi\u1EDD b\u1EA1n c\xF3 th\u1EC3 n\u1ED9p h\u1ED3 s\u01A1 b\u1EB1ng c\xE1ch \u0111i\u1EC1n email v\xE0 \u1EA5n g\u1EEDi!'),a('[status="cv_none"]').addClass('hide'),a('[status="cv_check"]').removeClass('hide'),p=1):('string'==typeof s.errors.message&&alert(s.errors.message),'object'==typeof s.errors.message&&alert(s.errors.message[Object.keys(s.errors.message)[0]]))},error:function(){},complete:function(){}})}function m(){a.ajax({url:'ajax/update-cv',method:'PUT',headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},data:a('#form-update').serialize(),success:function(s){1==s.status?alert('C\u1EADp nh\u1EADt th\xE0nh c\xF4ng!'):('string'==typeof s.errors.message&&alert(s.errors.message),'object'==typeof s.errors.message&&alert(s.errors.message[Object.keys(s.errors.message)[0]]))},error:function(){},complete:function(){}})}function n(){for(var s='',t='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',u=0;9>u;u++)s+=t.charAt(Math.floor(Math.random()*t.length));return s}a('#lookup .form-group .title').click(function(){a('#lookup .form-group').toggleClass('active')});var o,p,q=0,r=!1;'/xung-quanh'==location.pathname&&(c('','html'),a('.sidebar').on('scroll',function(){var s=a('.sidebar');parseInt(s[0].scrollHeight-s.scrollTop())<=parseInt(s.outerHeight()+3)&&0==a('.jobs-listing .job-item').length%10&&c(a('.search input').val())})),'/employer/jobs'==location.pathname&&(c('','html',!0),a('.jobs-listing').on('scroll',function(){var s=a('.jobs-listing');parseInt(s[0].scrollHeight-s.scrollTop())<=parseInt(s.outerHeight())&&0==a('.jobs-listing .job-item').length%10&&c(a('.search input').val(),'',!0)})),'/'==location.pathname&&(b(),a(window).on('scroll',function(){var s=a('body');parseInt(s[0].scrollHeight-a(window).scrollTop())<=parseInt(a(window).outerHeight())&&0==a('.jobs-listing .job-item').length%10&&(q++,d(a('[name="job_form"]:checked').val(),a('[name="job_type"]').val(),a('[name="job_city"]').val(),a('[name="job_wage"]').val(),a('[name="job_wage_type"]').val()))})),'#register'==location.hash&&(p=2,a('[status="cv_none"]').removeClass('hide'),a('[status="cv_check"]').addClass('hide'),a('#modal-send_cv').modal('show'),location.hash=''),a.get('/tiva/js/city.json',function(s){a.each(s,function(t,u){a('select[name="job_city"]').append(a('<option>').attr('data-id',t).attr('value',u.name).text(u.name))})}),a('.search input').keyup(function(){var s=a(this);o&&clearTimeout(o),'/xung-quanh'==location.pathname&&(o=setTimeout(function(){q=0,c(s.val(),'html'),a('.jobs-listing').scrollTop(0)},500)),'/employer/jobs'==location.pathname&&(o=setTimeout(function(){q=0,c(s.val(),'html',!0),a('.jobs-listing').scrollTop(0)},500))}),a('.btn-search').click(function(){q=0,d(a('[name="job_form"]:checked').val(),a('[name="job_type"]').val(),a('[name="job_city"]').val(),a('[name="job_wage"]').val(),a('[name="job_wage_type"]').val(),'html'),a(window).scrollTop(0)}),a('.btn-chosen-image').click(function(){a(this).parent().find('[file-input]').trigger('click')}),a('[file-input]').change(function(){var s=a(this),t=s.attr('file-input'),u=s.attr('employer-id');if(0!=s[0].files.length){for(var v=new FormData,w=s[0].files.length,y=0;y<w;y++)v.append('files[]',s[0].files[y]);a.ajax({url:'/employer/gallery-update/'+u,method:'POST',data:v,enctype:'multipart/form-data',contentType:!1,processData:!1,headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},success:function(z){1==z.status&&a.each(z.result,function(A,B){a('[file-output="'+t+'"]').append('<div class="card"><img class="card-img-top" src="/'+B+'"><input type="hidden" name="gallery[]" value="'+B+'"><i class="photo-close fa fa-trash-o" employer-id="'+u+'"></i></div>')})},error:function(){},complete:function(){s.val('')}})}}),a('body').delegate('.photo-close','click',function(){var s=a(this),t=s.attr('employer-id');a.ajax({url:'/employer/gallery-delete/'+t,method:'POST',data:{image:s.parent().find('input[name="gallery[]"]').val()},headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},success:function(u){1==u.status&&s.parent().remove()},error:function(){},complete:function(){}})}),a('body').delegate('.job-item','click',function(){'/employer/jobs'==location.pathname?f(a(this).attr('job-id')):e(a(this).attr('job-id'))}),a('body').delegate('[cv-update-href]','click',function(){g(a(this).attr('cv-update-href'),a(this).attr('cv-update-status'),a(this))}),a('body').delegate('[cv-active-href]','click',function(){h(a(this).attr('cv-active-href'),a(this).attr('cv-update-active'),a(this))}),a('body').delegate('[cv-delete-href]','click',function(){j(a(this).attr('cv-delete-href'),a(this))}),a('body').delegate('.btn-cv','click',function(){a('#modal-send_cv').attr('job-id',a(this).attr('job-id')),p=1,a('[status="cv_none"]').addClass('hide'),a('[status="cv_check"]').removeClass('hide')}),a('body').delegate('.btn-post-cv','click',function(){1==p&&k(a('input[name="user-email"]').val(),a('#modal-send_cv').attr('job-id')),2==p&&l()}),a('.btn-update-cv').click(function(){m()}),a('.add-row').click(function(){var s=a(this),t=s.attr('tab-id'),u=n(),v='<tr>';v+='<td><input type="text" name="tabs['+t+'][rows]['+u+'][name]" class=""></td>',v+='<td><input type="text" name="tabs['+t+'][rows]['+u+'][description]" class=""></td>',v+='<td><input type="text" name="tabs['+t+'][rows]['+u+'][date_start]" class="yearpicker-new"></td>',v+='<td><input type="text" name="tabs['+t+'][rows]['+u+'][date_end]" class="yearpicker-new"></td>',v+='<td><a href="javascript:void(0)" out-data="text">Xo\xE1</i></a></td>',v+='</tr>',a('#option-table-'+t+' tbody').append(v),a('.yearpicker-new').datepicker({format:'yyyy',viewMode:'years',minViewMode:'years',startDate:'1950',endDate:new Date})}),0<a('.select-row').length&&a('.select-row').chosen({no_results_text:'Oops, nothing found!',width:'30%'}),0<a('.standardSelect').length&&a('.standardSelect').chosen({disable_search_threshold:10,no_results_text:'Oops, nothing found!',width:'100%'}),0<a('.datepicker').length&&a('.datepicker').datepicker({format:'dd/mm/yyyy'}),0<a('.yearpicker-new').length&&a('.yearpicker-new').datepicker({format:'yyyy',viewMode:'years',minViewMode:'years',startDate:'1950',endDate:new Date}),a('.select-row').on('change',function(){var u=a(this),v=u.attr('tab-id'),w=u.find('option:selected'),y=n(),z='<tr>';z+='<td style="display: none"><label> <input type="hidden" name="tabs['+v+'][rows]['+y+'][option_id]" value="'+u.val()+'"> </label></td>',z+='<td><input type="text" disabled class="" value="'+w.text()+'"></td>',z+='<td><input type="text" name="tabs['+v+'][rows]['+y+'][description]" class=""></td>',z+='<td><input type="text" name="tabs['+v+'][rows]['+y+'][date_start]" class="yearpicker-new"></td>',z+='<td><input type="text" name="tabs['+v+'][rows]['+y+'][date_end]" class="yearpicker-new"></td>',z+='<td><a href="javascript:void(0)" out-data="select">Xo\xE1</a></td>',z+='</tr>',a('#option-table-'+v+' tbody').append(z),w.attr('disabled',''),u.val('').trigger('chosen:updated'),a('.yearpicker-new').datepicker({autoclose:!0,format:' yyyy',viewMode:'years',minViewMode:'years',startDate:'1950',endDate:new Date})}),a('body').delegate('[out-data]','click',function(){if('select'==a(this).attr('out-data')){var s=a(this).parent().parent().find('td:nth-child(1) input').val();a(this).parent().parent().parent().parent().parent().parent().find('.select-row option[value="'+s+'"]').removeAttr('disabled'),a(this).parent().parent().parent().parent().parent().parent().find('.select-row').trigger('chosen:updated')}a(this).parent().parent().remove()}),a('body').delegate('[in-data]','click',function(){var s=a(this);a.ajax({url:s.attr('a-href'),method:'PUT',headers:{'X-CSRF-TOKEN':a('meta[name="csrf-token"]').attr('content')},success:function(t){if(1==t.status){if('select'==s.attr('in-data')){var u=s.parent().parent().find('td:nth-child(1) input').val();s.parent().parent().parent().parent().parent().parent().find('.select-row option[value="'+u+'"]').removeAttr('disabled'),s.parent().parent().parent().parent().parent().parent().find('.select-row').trigger('chosen:updated')}s.parent().parent().remove()}},error:function(){},complete:function(){}})}),a('body').delegate('.chosen-image','change',function(){var s=a(this),t=event.srcElement.files;if(t[0]){var u=new FileReader,v=/^(image\/bmp|image\/cis-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x-cmu-raster|image\/x-cmx|image\/x-icon|image\/x-portable-anymap|image\/x-portable-bitmap|image\/x-portable-graymap|image\/x-portable-pixmap|image\/x-rgb|image\/x-xbitmap|image\/x-xpixmap|image\/x-xwindowdump)$/i;u.onload=function(w){return v.test(t[0].type)?void s.parent().find('img').attr('src',w.target.result):(alert('error chosen file'),void s.val(''))},u.readAsDataURL(event.target.files[0])}else s.parent().find('img').attr('old-src')?s.parent().find('img').attr('src',s.parent().find('img').attr('old-src')):s.parent().find('img').attr('src','/imgs/no_image.jpg')})});